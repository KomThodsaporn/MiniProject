<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>คิวเพลงสด</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1><span class="live-dot"></span> คิวเพลง...</h1>
        <ul id="song-list">
            <!-- Song items will be injected here -->
        </ul>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const songList = document.getElementById('song-list');
        const socket = io();

        socket.on('update_queue', (queue) => {
            songList.innerHTML = ''; // Clear the list

            if (queue.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'ไม่มีเพลงในคิว...';
                li.classList.add('empty');
                songList.appendChild(li);
            } else {
                queue.forEach(song => {
                    const li = document.createElement('li');

                    const songDetails = document.createElement('div');
                    songDetails.classList.add('song-details');

                    const songName = document.createElement('span');
                    songName.textContent = song.name;
                    songName.classList.add('song-name');
                    songDetails.appendChild(songName);

                    const songArtist = document.createElement('span');
                    songArtist.textContent = song.artist;
                    songArtist.classList.add('song-artist');
                    songDetails.appendChild(songArtist);

                    // *** NEW: Add a comment if the song was already played today ***
                    if (song.wasPlayedToday) {
                        const playedComment = document.createElement('span');
                        playedComment.textContent = ' (เล่นไปแล้ววันนี้)';
                        playedComment.classList.add('played-today-comment');
                        songArtist.appendChild(playedComment); // Append it next to the artist
                    }
                    
                    li.appendChild(songDetails);

                    const buttonGroup = document.createElement('div');
                    buttonGroup.classList.add('button-group');

                    const playedButton = document.createElement('button');
                    playedButton.textContent = 'เล่นแล้ว';
                    playedButton.classList.add('played-btn');
                    playedButton.onclick = () => markAsPlayed(song.id);
                    buttonGroup.appendChild(playedButton);

                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'ลบ';
                    deleteButton.classList.add('remove-btn');
                    deleteButton.onclick = () => deleteSong(song.id);
                    buttonGroup.appendChild(deleteButton);

                    li.appendChild(buttonGroup);
                    songList.appendChild(li);
                });
            }
        });

        function markAsPlayed(songId) {
            socket.emit('song_played', songId);
        }

        function deleteSong(songId) {
            socket.emit('delete_song', songId);
        }
    </script>
</body>
</html>
